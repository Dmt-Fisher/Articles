

# Описание протокола HTTP

HTTP (англ. HyperText Transfer Protocol — «протокол передачи гипертекста») — протокол прикладного уровня передачи произвольных данных (аналоги FTP, SMTP). Основой HTTP является технология «клиент-сервер», то есть предполагается существование потребителей (клиентов), которые инициируют соединение и посылают запрос, и поставщиков (серверов), которые ожидают соединения для получения запроса, производят необходимые действия и возвращают обратно сообщение с результатом. HTTP используется для получения информации с веб-сайтов, а также в качестве «транспорта» для других протоколов прикладного уровня, таких как SOAP, XML-RPC, WebDAV.

Основным объектом манипуляции в HTTP является ресурс (файлы, логические объекты или что-то абстрактное), на который указывает URI (Uniform Resource Identifier) в запросе клиента. Особенностью протокола HTTP является возможность указать в запросе/ответе способ представления одного и того же ресурса по различным параметрам: формату, кодировке, языку и т. д. Такая возможность  позволяет обмениваться двоичными данными. HTTP не сохраняет своего  состояния. Программное обеспечение (ПО) для работы с протоколом разделяется на категории:

- Серверы как основные поставщики услуг хранения и обработки информации (обработка запросов). Основныереализации: Apache, IIS, nginx, Google Web Server, lighttpd.
- Клиенты — конечные потребители услуг сервера (отправка запроса). Основные реализации:  браузеры, менеджер загрузок, роботы, веб-пауки и другие.
- Прокси для выполнения транспортных служб. (Squid, UserGate, Multiproxy, Naviscope, nginx)

Серверы обозначают в официальной документации термином «исходный сервер» (англ. origin server). ПО может одновременно выполнять функции клиента, сервера или посредника. Подробнее описано в спецификации протокола HTTP. Спецификакации:HTTP/1.0 –[RFC 1945](https://tools.ietf.org/html/rfc1945); HTTP/1.1 –[RFC 2068](https://tools.ietf.org/html/rfc2068),[RFC 2616](https://tools.ietf.org/html/rfc2616),[RFC 7230](https://tools.ietf.org/html/rfc7230),[RFC 7231](https://tools.ietf.org/html/rfc7231),[RFC 7232](https://tools.ietf.org/html/rfc7232),[RFC 7233](https://tools.ietf.org/html/rfc7233),[RFC 7234](https://tools.ietf.org/html/rfc7234),[RFC 7235](https://tools.ietf.org/html/rfc7235); HTTP/2.0 – в разработке.

## Структура протокола

Каждое HTTP-сообщение состоит из трёх частей, которые передаются в указанном порядке:

I. Стартовая строка (англ. Starting line) — определяет тип: запрос/ответ (обязательна в сообщении).
II. Заголовки (англ. Headers) — характеризуют тело сообщения, параметры передачи и прочие сведения (могут отсутствовать) Формат содержит пару имя (англ. name) – значение (англ. value), разделённую двоеточием (RFC 822). Можно вводить свои заголовки, добавляя «X-» для избежания конфликта имён с возможно существующими. Рекомендован следующий порядок отправки заголовков получателю:

  1) Request Headers («Заголовки запроса») — используются только в запросах клиента.
  2) Response Headers («Заголовки ответа») — только для ответов от сервера.
  3) Entity Headers («Заголовки сущности») — сопровождают каждую сущность сообщения.

III. Тело сообщения (англ. Message Body) — непосредственно данные сообщения (может отсутствовать). Отделяется от заголовков пустой строкой. Формат тела и порядок работы с ним в настоящий момент не определён. Сервер пока должен его игнорировать. Аналогичная ситуация и с телом в ответе сервера. Тело сообщения (message-body) отличается от тела объекта (entity-body) только в том случае, когда применяется кодирование передачи, что указывается полем заголовка Transfer-Encoding. HTTP поддерживает передачу нескольких сущностей (медиатип multipart/\*) в пределах одного сообщения (см. [_MIME_](https://ru.wikipedia.org/wiki/MIME), [RFC 2046](https://tools.ietf.org/html/rfc2046)).

Включается или не включается тело сообщения в сообщение ответа зависит от метода запроса и от кода состояния ответа. Все ответы на запрос с методом HEAD не должны включать тело сообщения, даже если присутствуют поля заголовка объекта (entity-header). Никакие ответы с кодами состояния 1xx (Информационные), 204 (Нет содержимого, No Content), и 304 (Не модифицирован, Not Modified) не должны содержать тела сообщения (message-body). Все другие ответы содержат тело сообщения, даже если оно имеет нулевую длину.

## Методы

Каждый сервер обязан поддерживать методы GET и HEAD.

GET – запрос содержимого ресурса или начала процесса. Идемпотентный. Возможна передача параметров в URI после символа «?». Для проверки новых версий ресурса используется условный GET (заголовки If-Modified-Since, If-Match, If-Range и подобные). Для получения фрагмента ресурса применяется частичный GET (содержит в запросе Range).

HEAD – для извлечения метаданных, валидации URL и изменения с момента последнего обращения. Аналогичен GET, в ответе сервера отсутствует тело. Может кэшироваться.

POST – для передачи данных заданному ресурсу. Не считается идемпотентным. Сообщение ответа сервера не кэшируется.

OPTIONS – для определения возможностей или параметров соединения для конкретного ресурса. Запросы «OPTIONS \* HTTP/1.1» применяются для проверки работоспособности и тестирования сервера. Результат не кэшируется.

PUT – для загрузки содержимого запроса (подробнее см. спецификации протокола HTTP).

PATCH – Аналогично PUT, но применяется только к фрагменту ресурса.

DELETE – Удаляет указанный ресурс.

TRACE – Для получения информации от промежуточных серверов.

CONNECT – Преобразует соединение запроса в прозрачный TCP/IP-туннель, обычно чтобы содействовать установлению защищённого SSL-соединения через нешифрованный прокси.

## Коды состояния

1xx Informational («Информационный»)

2xx Success («Успех»)

3xx Redirection («Перенаправление») Адрес сервер указывает в Location.

4xx Client Error («Ошибка клиента»).

5xx Server Error («Ошибка сервера»)

Первая цифра указывает на класс состояния. За кодом ответа обычно следует поясняющая фраза. Набор кодов состояния является стандартом, и они описаны в документах RFC. Введение новых кодов производится после согласования с IETF. Клиент может не знать все коды состояния, но он обязан отреагировать в соответствии с классом кода. (см. [_Список кодов состояния HTTP_](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP))

## Согласование содержимого

Согласование содержимого (англ. Content Negotiation) — механизм автоматического определения необходимого ресурса при наличии нескольких разнотипных версий документа. Субъектами согласования могут быть ресурсы сервера, страницы с сообщениями об ошибках (403, 404 и т. п.).

Типа согласований: управляемое сервером (англ. Server-Driven), управляемое клиентом (англ. Agent-Driven). Одновременно могут быть использованы оба типа или каждый из них по отдельности. В [RFC 2616](https://tools.ietf.org/html/rfc2616) выделяется прозрачное согласование (англ. Transparent Negotiation) как предпочтительный вариант комбинирования обоих типов.

## Особенности протокола

Большинство протоколов предусматривают установление TCP-сессии, в ходе которой один раз происходит авторизация, и дальнейшие действия выполняются в контексте этой авторизации. HTTP же устанавливает отдельную TCP-сессию на каждый запрос; в более поздних версиях HTTP было разрешено делать несколько запросов в ходе одной TCP-сессии, но браузеры обычно запрашивают только страницу и включённые в неё объекты (картинки, каскадные стили и т. п.), а затем сразу разрывают TCP-сессию. Для поддержки авторизованного (не анонимного) доступа в HTTP используются cookies; причём такой способ авторизации позволяет сохранить сессию даже после перезагрузки клиента и сервера.

HTTP перед тем, как передать сами данные, передаёт заголовок «Content-Type: тип/подтип», позволяющий клиенту однозначно определить, каким образом обрабатывать присланные данные, и параметры, которые будут переданы запускаемому CGI-скрипту. Для этого же в HTML были введены формы (см. [RFC 1867](https://tools.ietf.org/html/rfc1867)). Перечисленные особенности HTTP позволили создавать поисковые машины (первой из которых стала AltaVista, созданная фирмой DEC), форумы и интернет-магазины.

# Источники

1. Википедия – [https://ru.wikipedia.org/wiki/HTTP](https://ru.wikipedia.org/wiki/HTTP)
2. Programmerbook.ru – [http://programmerbook.ru/html/a/href/http/](http://programmerbook.ru/html/a/href/http/)

